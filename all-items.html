<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All Items ‚Äî Phil's Moving Sale</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:#f5f5f7;color:#1d1d1f}
.header{background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);color:#fff;text-align:center;padding:2.5rem 1rem 1.5rem}
.header h1{font-size:2.4rem;font-weight:800;margin-bottom:.5rem;letter-spacing:-.5px}
.header .subtitle{font-size:1.1rem;opacity:.85;font-weight:400}
.header .emoji-bar{font-size:1.6rem;margin-top:.8rem;letter-spacing:8px}
.nav-bar{display:flex;gap:.5rem;justify-content:center;margin-top:1.2rem;flex-wrap:wrap}
.nav-bar a{color:#fff;text-decoration:none;padding:.5rem 1.2rem;border-radius:99px;font-size:.9rem;font-weight:600;border:2px solid rgba(255,255,255,.3);transition:all .2s}
.nav-bar a:hover{background:rgba(255,255,255,.15)}
.nav-bar a.active{background:rgba(255,255,255,.2);border-color:rgba(255,255,255,.6)}
.controls{max-width:1200px;margin:0 auto;padding:1.2rem 1rem .5rem;display:flex;gap:.8rem;flex-wrap:wrap;align-items:center}
.search-box{flex:1;min-width:200px;padding:.65rem 1rem;border:2px solid #e5e7eb;border-radius:12px;font-family:inherit;font-size:.95rem;outline:none;transition:border-color .2s}
.search-box:focus{border-color:#0f3460}
.cat-filter{padding:.65rem 1rem;border:2px solid #e5e7eb;border-radius:12px;font-family:inherit;font-size:.95rem;background:#fff;outline:none;cursor:pointer}
.count{font-size:.85rem;color:#9ca3af;font-weight:500;padding:0 .5rem}
.container{max-width:1200px;margin:0 auto;padding:1rem}
.item-list{background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.06)}
.list-row{display:flex;align-items:center;padding:.85rem 1.2rem;cursor:pointer;transition:background .15s;border-bottom:1px solid #f0f0f0;gap:1rem}
.list-row:last-child{border-bottom:none}
.list-row:nth-child(even){background:#fafbfc}
.list-row:hover{background:#eef2ff}
.list-row .row-name{font-weight:700;font-size:.95rem;color:#1d1d1f;min-width:0;flex-shrink:0}
.list-row .row-desc{flex:1;font-size:.85rem;color:#6b7280;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:0;padding:0 .5rem}
.list-row .row-cat{font-size:.7rem;font-weight:600;background:#dbeafe;color:#1e40af;padding:.2rem .6rem;border-radius:99px;white-space:nowrap;flex-shrink:0}
.list-row .row-price{font-weight:600;font-size:.9rem;color:#0f3460;white-space:nowrap;text-align:right;flex-shrink:0;min-width:80px}
@media(max-width:560px){.header h1{font-size:1.6rem}.header .subtitle{font-size:.95rem}.list-row{flex-wrap:wrap;gap:.3rem;padding:.75rem 1rem}.list-row .row-desc{display:none}.list-row .row-name{flex:1}.list-row .row-price{margin-left:auto}}
.badge{display:inline-block;padding:.2rem .6rem;border-radius:99px;font-size:.7rem;font-weight:600;letter-spacing:.3px}
.badge-cat{background:#dbeafe;color:#1e40af}
.no-results{text-align:center;padding:3rem;color:#9ca3af;font-size:1.1rem}

/* Modal */
.modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:200;align-items:center;justify-content:center;padding:1rem}
.modal-overlay.show{display:flex}
.modal{background:#fff;border-radius:20px;max-width:700px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.3);position:relative}
.modal-close{position:absolute;top:12px;right:12px;background:rgba(0,0,0,.5);color:#fff;border:none;width:36px;height:36px;border-radius:50%;font-size:1.3rem;cursor:pointer;z-index:10;display:flex;align-items:center;justify-content:center;line-height:1}
.modal-close:hover{background:rgba(0,0,0,.7)}
.modal-gallery{position:relative;height:350px;background:#1a1a2e;display:flex;align-items:center;justify-content:center;overflow:hidden;border-radius:20px 20px 0 0}
.modal-gallery img{max-width:100%;max-height:100%;object-fit:contain}
.modal-gallery .no-photo{color:#6b7280;font-size:1.2rem}
.modal-gallery .gal-nav{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.2);border:none;color:#fff;width:40px;height:40px;border-radius:50%;cursor:pointer;font-size:1.2rem;display:flex;align-items:center;justify-content:center;transition:background .2s}
.modal-gallery .gal-nav:hover{background:rgba(255,255,255,.4)}
.modal-gallery .gal-prev{left:10px}
.modal-gallery .gal-next{right:10px}
.modal-gallery .gal-dots{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);display:flex;gap:6px}
.modal-gallery .gal-dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.4);cursor:pointer;transition:background .2s}
.modal-gallery .gal-dot.active{background:#fff}
.modal-gallery .gal-counter{position:absolute;top:12px;left:12px;background:rgba(0,0,0,.5);color:#fff;padding:.2rem .6rem;border-radius:8px;font-size:.75rem;font-weight:600}
.modal-body{padding:1.5rem 1.8rem 1.8rem}
.modal-body h2{font-size:1.4rem;font-weight:800;margin-bottom:.5rem}
.modal-body .modal-price{font-size:1.2rem;color:#0f3460;font-weight:700;margin-bottom:.8rem}
.modal-body .modal-meta{display:flex;gap:.6rem;margin-bottom:1rem;flex-wrap:wrap}
.modal-body .modal-desc{font-size:.95rem;color:#4b5563;line-height:1.6;margin-bottom:1.5rem}
.modal-body .btn-contact{display:inline-flex;align-items:center;gap:.5rem;background:#0f3460;color:#fff;padding:.8rem 1.8rem;border-radius:12px;text-decoration:none;font-weight:600;font-size:1rem;transition:background .2s;border:none;cursor:pointer}
.modal-body .btn-contact:hover{background:#1a4a7a}
@media(max-width:560px){.modal-gallery{height:250px}.modal-body{padding:1.2rem}}

.contact{text-align:center;padding:3rem 1rem;background:#fff;margin-top:2rem;border-radius:16px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.contact h2{font-size:1.5rem;font-weight:700;margin-bottom:.5rem}
.contact p{color:#6b7280;margin-bottom:1.2rem}
.contact a{display:inline-flex;align-items:center;gap:.5rem;background:#0f3460;color:#fff;padding:.7rem 1.5rem;border-radius:10px;text-decoration:none;font-weight:600;font-size:1rem}
.footer{text-align:center;padding:2rem 1rem;color:#9ca3af;font-size:.8rem}
</style>
</head>
<body>

<div class="header">
<h1>Phil's Moving Sale</h1>
<p class="subtitle">Chinderah, NSW ‚Äî Moving to Thailand, all items must sell!</p>
<div class="emoji-bar">üè† ‚úàÔ∏è üáπüá≠</div>
<div class="nav-bar">
<a href="index.html">üìã Admin</a>
<a href="all-items.html" class="active">üõí All Items</a>
</div>
</div>

<div class="controls">
<input type="text" class="search-box" id="search" placeholder="üîç Search items...">
<select class="cat-filter" id="catFilter">
<option value="All">All Categories</option>
</select>
<span class="count" id="count"></span>
</div>

<div class="container">
<div class="item-list" id="grid"></div>
<div class="no-results" id="noResults" style="display:none">No items match your search.</div>
<div class="contact">
<h2>Interested in something?</h2>
<p>Get in touch ‚Äî happy to answer questions or arrange a viewing in Chinderah.</p>
<a href="tel:0412397443">üìû Contact Phil @ 0412 397 443</a>
</div>
</div>

<div class="modal-overlay" id="modalOverlay">
<div class="modal" id="modal">
<button class="modal-close" id="modalClose">‚úï</button>
<div class="modal-gallery" id="modalGallery"></div>
<div class="modal-body" id="modalBody"></div>
</div>
</div>

<div class="footer">Last updated: 16 February 2026 &nbsp;|&nbsp; Chinderah, NSW</div>

<script>
let items = [];
const cats = ["All","Furniture","Appliances","Kitchen","Electronics","Bedroom/Bathroom","Car","Misc"];
const photos = {}; // itemId -> [url, ...]
const catFilter = document.getElementById('catFilter');
const searchBox = document.getElementById('search');
const gridEl = document.getElementById('grid');
const noResults = document.getElementById('noResults');
const countEl = document.getElementById('count');

// Populate category filter
cats.filter(c => c !== 'All').forEach(c => {
  const o = document.createElement('option'); o.value = c; o.textContent = c;
  catFilter.appendChild(o);
});

// Load items and photos from API
async function loadData() {
  try {
    const res = await fetch('/api/items');
    const data = await res.json();
    items = data;
  } catch (e) { console.warn('Could not load items', e); }
  try {
    const res = await fetch('/api/photos');
    const data = await res.json();
    Object.keys(data).forEach(k => {
      photos[k] = data[k].map(p => typeof p === 'string' ? p : p.url);
    });
  } catch (e) { console.warn('Could not load photos', e); }
}

function getPrice(idx) {
  return items[idx].price || 'Price on request';
}

function getName(idx) {
  return items[idx].name;
}

function getDesc(idx) {
  return items[idx].description || items[idx].desc || '';
}

function getCat(idx) {
  return items[idx].category || items[idx].cat || '';
}

function render() {
  const query = searchBox.value.toLowerCase().trim();
  const cat = catFilter.value;
  
  const filtered = items.map((item, idx) => ({ item, idx })).filter(({ item, idx }) => {
    const itemCat = getCat(idx);
    if (cat !== 'All' && itemCat !== cat) return false;
    if (query) {
      const name = getName(idx).toLowerCase();
      const desc = getDesc(idx).toLowerCase();
      if (!name.includes(query) && !desc.includes(query) && !itemCat.toLowerCase().includes(query)) return false;
    }
    return true;
  });

  gridEl.innerHTML = '';
  filtered.forEach(({ item, idx }) => {
    const row = document.createElement('div');
    row.className = 'list-row';
    row.innerHTML = `
      <span class="row-name">${getName(idx)}</span>
      <span class="row-desc">${getDesc(idx)}</span>
      <span class="row-cat">${getCat(idx)}</span>
      <span class="row-price">${getPrice(idx)}</span>`;
    row.addEventListener('click', () => openModal(idx));
    gridEl.appendChild(row);
  });

  countEl.textContent = `${filtered.length} item${filtered.length !== 1 ? 's' : ''}`;
  noResults.style.display = filtered.length === 0 ? 'block' : 'none';
}

// Modal
const modalOverlay = document.getElementById('modalOverlay');
const modalGallery = document.getElementById('modalGallery');
const modalBody = document.getElementById('modalBody');
let modalIdx = 0, modalPhotoIdx = 0;

function openModal(idx) {
  modalIdx = idx;
  modalPhotoIdx = 0;
  renderModal();
  modalOverlay.classList.add('show');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  modalOverlay.classList.remove('show');
  document.body.style.overflow = '';
}

function renderModal() {
  const idx = modalIdx;
  const itemId = items[idx].id;
  const imgs = photos[itemId] || [];
  const name = getName(idx);
  const price = getPrice(idx);
  const desc = getDesc(idx);
  const item = items[idx];

  // Gallery
  if (imgs.length === 0) {
    modalGallery.innerHTML = '<div class="no-photo">üì¶ No photos yet</div>';
  } else {
    const nav = imgs.length > 1 ? `
      <button class="gal-nav gal-prev" id="galPrev">‚Äπ</button>
      <button class="gal-nav gal-next" id="galNext">‚Ä∫</button>
      <div class="gal-dots">${imgs.map((_, i) => `<div class="gal-dot${i === modalPhotoIdx ? ' active' : ''}" data-i="${i}"></div>`).join('')}</div>
      <div class="gal-counter">${modalPhotoIdx + 1} / ${imgs.length}</div>` : '';
    modalGallery.innerHTML = `<img src="${imgs[modalPhotoIdx]}" alt="${name}">${nav}`;

    if (imgs.length > 1) {
      document.getElementById('galPrev').addEventListener('click', e => { e.stopPropagation(); modalPhotoIdx = (modalPhotoIdx - 1 + imgs.length) % imgs.length; renderModal(); });
      document.getElementById('galNext').addEventListener('click', e => { e.stopPropagation(); modalPhotoIdx = (modalPhotoIdx + 1) % imgs.length; renderModal(); });
      modalGallery.querySelectorAll('.gal-dot').forEach(d => d.addEventListener('click', e => { e.stopPropagation(); modalPhotoIdx = parseInt(d.dataset.i); renderModal(); }));
    }
  }

  // Touch swipe
  let touchStartX = 0;
  modalGallery.ontouchstart = e => { touchStartX = e.touches[0].clientX; };
  modalGallery.ontouchend = e => {
    if (imgs.length <= 1) return;
    const diff = touchStartX - e.changedTouches[0].clientX;
    if (Math.abs(diff) > 50) {
      modalPhotoIdx = diff > 0 ? (modalPhotoIdx + 1) % imgs.length : (modalPhotoIdx - 1 + imgs.length) % imgs.length;
      renderModal();
    }
  };

  // Body
  modalBody.innerHTML = `
    <h2>${name}</h2>
    <div class="modal-price">${price}</div>
    <div class="modal-meta">
      <span class="badge badge-cat">${getCat(idx)}</span>
      <span class="badge" style="background:#d1fae5;color:#065f46">Available</span>
    </div>
    <p class="modal-desc">${desc}</p>
    <a href="tel:0412397443" class="btn-contact">üìû Contact Phil ‚Äî 0412 397 443</a>`;
}

document.getElementById('modalClose').addEventListener('click', closeModal);
modalOverlay.addEventListener('click', e => { if (e.target === modalOverlay) closeModal(); });
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

// Event listeners
searchBox.addEventListener('input', render);
catFilter.addEventListener('change', render);

// Init
loadData().then(() => render()).catch(() => render());
</script>
</body>
</html>
